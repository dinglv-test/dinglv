<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>定律测试V1.0</title>
    <style>
        /* 全局样式重置 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            max-width: 800px;
            width: 100%;
            overflow: hidden;
            transition: transform 0.3s ease;
        }
        
        .container:hover {
            transform: translateY(-2px);
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .content {
            padding: 40px 30px;
        }
        
        /* 测试视图样式 */
        #test-view {
            display: block;
        }
        
        .progress-container {
            margin-bottom: 30px;
        }
        
        .progress-bar {
            height: 8px;
            background-color: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0;
        }
        
        .progress-text {
            text-align: right;
            font-size: 0.9rem;
            color: #666;
        }
        
        .question-container {
            margin-bottom: 30px;
        }
        
        .question-number {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            text-align: center;
            line-height: 32px;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }
        
        .question-text {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 25px;
            line-height: 1.6;
        }
        
        .options-container {
            display: grid;
            gap: 15px;
        }
        
        .option {
            padding: 18px 20px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: white;
            display: flex;
            align-items: flex-start;
        }
        
        .option:hover {
            border-color: #667eea;
            background-color: #f8f9ff;
            transform: translateY(-1px);
        }
        
        .option.selected {
            border-color: #667eea;
            background-color: #f0f2ff;
        }
        
        .option-letter {
            font-weight: 600;
            color: #667eea;
            margin-right: 12px;
            min-width: 20px;
        }
        
        .option-text {
            font-size: 1rem;
        }
        
        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid #e9ecef;
        }
        
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .btn-secondary {
            background-color: #e9ecef;
            color: #495057;
        }
        
        .btn-secondary:hover:not(:disabled) {
            background-color: #dee2e6;
            transform: translateY(-1px);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        /* 结果视图样式 */
        #result-view {
            display: none;
            text-align: center;
        }
        
        .result-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            color: #667eea;
        }
        
        .result-title {
            font-size: 2rem;
            margin-bottom: 20px;
            color: #333;
        }
        
        .result-score {
            display: none !important;
        }
        
        .result-description {
            margin-top: 20px;
        }
        
        .result-score {
            background-color: #f8f9ff;
            padding: 20px;
            border-radius: 8px;
            margin: 30px 0;
        }
        
        .result-score h3 {
            margin-bottom: 15px;
            color: #495057;
        }
        
        .score-items {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .score-item {
            background-color: white;
            padding: 15px 25px;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            min-width: 100px;
        }
        
        .score-letter {
            font-size: 1.8rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .score-number {
            font-size: 1.2rem;
            color: #495057;
        }
        
        .result-description {
            text-align: left;
            line-height: 1.8;
            color: #495057;
            margin-top: 30px;
        }
        
        .result-description p {
            margin-bottom: 15px;
        }
        
        .restart-btn {
            margin-top: 40px;
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }
            
            .content {
                padding: 30px 20px;
            }
            
            .question-text {
                font-size: 1.1rem;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
            
            .result-title {
                font-size: 1.6rem;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .header {
                padding: 30px 20px;
            }
            
            .header h1 {
                font-size: 1.6rem;
            }
            
            .header p {
                font-size: 1rem;
            }
            
            .content {
                padding: 25px 15px;
            }
            
            .option {
                padding: 15px 15px;
            }
            
            .navigation {
                flex-direction: column;
                gap: 15px;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>定律测试V1.0</h1>
            <p>探索你的真实性格类型</p>
        </div>
        
        <div class="content">
            <!-- 测试视图 -->
            <div id="test-view">
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <div class="progress-text"><span id="current-question">1</span>/20</div>
                </div>
                
                <div class="question-container">
                    <div class="question-number" id="question-number">1</div>
                    <div class="question-text" id="question-text">这里将显示题目内容</div>
                    
                    <div class="options-container">
                        <div class="option">
                            <div class="option-letter">A</div>
                            <div class="option-text">选项A内容</div>
                        </div>
                        <div class="option">
                            <div class="option-letter">B</div>
                            <div class="option-text">选项B内容</div>
                        </div>
                        <div class="option">
                            <div class="option-letter">C</div>
                            <div class="option-text">选项C内容</div>
                        </div>
                        <div class="option">
                            <div class="option-letter">D</div>
                            <div class="option-text">选项D内容</div>
                        </div>
                    </div>
                </div>
                
                <div class="navigation">
                    <button class="btn btn-secondary" id="prev-btn" onclick="prevQuestion()" disabled>上一题</button>
                    <button class="btn btn-primary" id="next-btn" onclick="nextQuestion()" disabled>下一题</button>
                </div>
            </div>
            
            <!-- 结果视图 -->
            <div id="result-view">
                <div class="result-icon">📊</div>
                <h2 class="result-title" id="result-title">你的人格类型</h2>
                
                <div class="result-score">
                    <h3>你的选择分布</h3>
                    <div class="score-items">
                        <div class="score-item">
                            <div class="score-letter">A</div>
                            <div class="score-number" id="score-a">0</div>
                        </div>
                        <div class="score-item">
                            <div class="score-letter">B</div>
                            <div class="score-number" id="score-b">0</div>
                        </div>
                        <div class="score-item">
                            <div class="score-letter">C</div>
                            <div class="score-number" id="score-c">0</div>
                        </div>
                        <div class="score-item">
                            <div class="score-letter">D</div>
                            <div class="score-number" id="score-d">0</div>
                        </div>
                    </div>
                </div>
                
                <div class="result-description" id="result-description">
                    <p>这里将显示详细的人格分析结果...</p>
                </div>
                
                <button class="btn btn-primary restart-btn" onclick="restartTest()">重新测试</button>
            </div>
        </div>
    </div>
    
    <script>
        // 初始化变量
        let currentQuestion = 0;
        let answers = [];
        
        // 四型人格测试题目数据
        const questions = [ 
            { 
                text: "如何看待\"婚姻中的物质投入\"（如彩礼、房、车）？", 
                options: [ 
                    { text: "这是必要的诚意证明，全力以赴才能换来稳定关系。", type: "A" }, 
                    { text: "这是需要理性评估的\"项目成本\"，应量力而行，分批投入。", type: "B" }, 
                    { text: "这是可谈判的筹码，如何用最小代价换取最大利益是关键。", type: "C" }, 
                    { text: "这不是核心，关键是双方当下的感觉和快乐，形式不重要。", type: "D" } 
                ] 
            }, 
            { 
                text: "当伴侣提出一个你暂时无法满足的物质要求时，你通常会？", 
                options: [ 
                    { text: "深感愧疚，并制定储蓄计划，决心尽快满足TA。", type: "A" }, 
                    { text: "分析要求的合理性，并尝试沟通分期实现或寻找替代方案。", type: "B" }, 
                    { text: "认为对方要求过高，或质疑TA的动机，可能因此产生争执。", type: "C" }, 
                    { text: "用其他方式转移注意力，比如带TA去玩，创造即时快乐。", type: "D" } 
                ] 
            }, 
            { 
                text: "你认为在感情中建立自身吸引力的关键是什么？", 
                options: [ 
                    { text: "通过稳定、可靠的物质条件和承诺来体现。", type: "A" }, 
                    { text: "通过展现解决问题的能力、知识储备和成长潜力。", type: "B" }, 
                    { text: "通过展现自信、掌控力，甚至略带侵略性的个人魅力。", type: "C" }, 
                    { text: "通过提供高情绪价值，如风趣、浪漫和'与众不同'的体验。", type: "D" } 
                ] 
            }, 
            { 
                text: "感情出现矛盾时，你的第一反应更倾向于？", 
                options: [ 
                    { text: "反思自己是不是做得不够好，付出得不够多。", type: "A" }, 
                    { text: "像分析程序BUG一样，逻辑化地梳理矛盾点，寻求解决方案。", type: "B" }, 
                    { text: "优先保护自己的感受，认为问题多半出在对方身上。", type: "C" }, 
                    { text: "不直接对抗，通过哄劝、逗乐等方式缓和气氛，回避正面冲突。", type: "D" } 
                ] 
            }, 
            { 
                text: "你如何理解\"承诺\"在关系中的分量？", 
                options: [ 
                    { text: "承诺是极其严肃的，一旦给出，就意味着长期的责任和付出。", type: "A" }, 
                    { text: "承诺需要清晰的边界和条件，会根据实际情况动态调整。", type: "B" }, 
                    { text: "承诺更多是一种即时的表态，其长期效力取决于未来形势。", type: "C" }, 
                    { text: "承诺不如当下的快乐重要，关系应自然发展，不必过度捆绑。", type: "D" } 
                ] 
            }, 
            { 
                text: "在社交场合（如朋友聚会），你更习惯的角色是？", 
                options: [ 
                    { text: "默默付出者，比如主动买单、照顾大家，以此表达关心。", type: "A" }, 
                    { text: "话题引导者或知识分享者，乐于提供有价值的信息。", type: "B" }, 
                    { text: "中心人物，掌控话题和节奏，希望大家关注自己。", type: "C" }, 
                    { text: "气氛活跃者，擅长开玩笑、制造轻松欢乐的氛围。", type: "D" } 
                ] 
            }, 
            { 
                text: "对于伴侣的过往情感经历，你的态度是？", 
                options: [ 
                    { text: "虽然介意，但会选择接受，并希望通过加倍付出超越其过去。", type: "A" }, 
                    { text: "会理性了解，作为评估双方价值观和契合度的参考信息。", type: "B" }, 
                    { text: "不太关心，更关注自己在这段关系中的主导权和控制力。", type: "C" }, 
                    { text: "完全不介意，甚至觉得有故事的伴侣更有意思，享受当下即可。", type: "D" } 
                ] 
            }, 
            { 
                text: "你更欣赏哪种关系状态？", 
                options: [ 
                    { text: "传统稳定，分工明确，共同为未来奋斗。", type: "A" }, 
                    { text: "共同成长，像伙伴一样互相支持，逻辑清晰，目标一致。", type: "B" }, 
                    { text: "自己占据明显主导地位，对方能充分满足自己的需求。", type: "C" }, 
                    { text: "轻松有趣，充满激情和变化，不必有太多规则和压力。", type: "D" } 
                ] 
            }, 
            { 
                text: "当一段关系结束时，你最主要的感受会是？", 
                options: [ 
                    { text: "巨大的挫败感和损失感，心疼自己巨大的投入付诸东流。", type: "A" }, 
                    { text: "会进行复盘分析，总结教训，为下一段关系优化策略。", type: "B" }, 
                    { text: "更容易将责任归因于对方，并迅速寻找新的可能性。", type: "C" }, 
                    { text: "虽会难过，但能较快走出，并怀念关系中美好的片段。", type: "D" } 
                ] 
            }, 
            { 
                text: "你选择伴侣时，最看重的是？", 
                options: [ 
                    { text: "对方的'宜家宜室'程度，是否适合长期共同生活。", type: "A" }, 
                    { text: "对方的逻辑思维能力、独立性和未来发展潜力。", type: "B" }, 
                    { text: "对方是否'带得出去'，以及是否顺从、能满足自己的面子。", type: "C" }, 
                    { text: "在一起是否开心、刺激，对方是否能理解并回应自己的情绪。", type: "D" } 
                ] 
            }, 
            { 
                text: "朋友评价你在一段关系中的状态，最可能用哪个词？", 
                options: [ 
                    { text: "'付出型'", type: "A" }, 
                    { text: "'理智型'", type: "B" }, 
                    { text: "'掌控型'", type: "C" }, 
                    { text: "'玩伴型'", type: "D" } 
                ] 
            }, 
            { 
                text: "你通常如何应对压力或负面情绪？", 
                options: [ 
                    { text: "自我消化，或更努力地工作/付出，试图用行动改变现状。", type: "A" }, 
                    { text: "分析压力源，制定应对策略，或通过学习新知识来缓解。", type: "B" }, 
                    { text: "向外释放，可能表现为抱怨、指责他人或寻求感官刺激。", type: "C" }, 
                    { text: "转移注意力，通过娱乐、社交或寻找新鲜事来快速摆脱。", type: "D" } 
                ] 
            }, 
            { 
                text: "你如何看待'仪式感'（如节日礼物、纪念日庆祝）？", 
                options: [ 
                    { text: "非常重要，是表达诚意和维持关系稳定的必要环节。", type: "A" }, 
                    { text: "有意义，但更注重礼物的实用性和庆祝方式的性价比。", type: "B" }, 
                    { text: "可用来表达心意，但更看重对方是否为自己精心准备。", type: "C" }, 
                    { text: "是制造惊喜和快乐的绝佳机会，但形式可以随心所欲。", type: "D" } 
                ] 
            }, 
            { 
                text: "在关系中，你更倾向于如何表达爱意？", 
                options: [ 
                    { text: "通过实际行动和物质保障，比如为对方解决实际问题。", type: "A" }, 
                    { text: "通过深度沟通和思想交流，为对方提供建议和支持。", type: "B" }, 
                    { text: "通过强势的保护和占有，宣示主权，让对方依赖自己。", type: "C" }, 
                    { text: "通过营造浪漫氛围和提供愉悦的情绪体验。", type: "D" } 
                ] 
            }, 
            { 
                text: "你对'个人空间'和'伴侣依赖'的平衡看法是？", 
                options: [ 
                    { text: "愿意为关系牺牲大量个人空间，认为依赖是紧密的表现。", type: "A" }, 
                    { text: "需要保持一定的独立空间，认为适度的距离有利于理性沟通。", type: "B" }, 
                    { text: "希望对方更依赖自己，而自己的空间则不容过多干涉。", type: "C" }, 
                    { text: "享受在一起的时光，但也需要自由，不喜欢被过度约束。", type: "D" } 
                ] 
            }, 
            { 
                text: "面对他人的批评或否定，你第一反应是？", 
                options: [ 
                    { text: "深刻自责，认为一定是自己做得不够好。", type: "A" }, 
                    { text: "冷静分析批评的合理性，如果有理就接受，无理则反驳。", type: "B" }, 
                    { text: "感到被冒犯，容易情绪激动，并可能反击对方。", type: "C" }, 
                    { text: "不太在意，或用幽默化解，觉得没必要较真。", type: "D" } 
                ] 
            }, 
            { 
                text: "你更认同以下哪种金钱观？", 
                options: [ 
                    { text: "节俭储蓄，为未来的家庭共同目标做准备。", type: "A" }, 
                    { text: "理性规划，投资和消费都基于长远计划和风险评估。", type: "B" }, 
                    { text: "及时行乐，钱是用来提升自身地位和享受生活的工具。", type: "C" }, 
                    { text: "随性而花，钱主要是为了获得当下的快乐和体验。", type: "D" } 
                ] 
            }, 
            { 
                text: "你认为维系长期关系最重要的因素是？", 
                options: [ 
                    { text: "不离不弃的责任感和持续的物质投入。", type: "A" }, 
                    { text: "共同的三观、有效的沟通机制和解决冲突的能力。", type: "B" }, 
                    { text: "相互的尊重（尤其是对方对自己的尊重）和实力的维持。", type: "C" }, 
                    { text: "始终保持关系的趣味性、激情和新鲜感。", type: "D" } 
                ] 
            }, 
            { 
                text: "你倾向于选择什么样的伴侣？", 
                options: [ 
                    { text: "适合过日子，踏实、贤惠/顾家的类型。", type: "A" }, 
                    { text: "聪明、有主见、能并肩作战的类型。", type: "B" }, 
                    { text: "外貌出众、或能彰显自身实力，带出去有面子的类型。", type: "C" }, 
                    { text: "好玩、有趣、能带来情绪波动和刺激的类型。", type: "D" } 
                ] 
            }, 
            { 
                text: "回顾过往关系，你认为自己最大的学习点是？", 
                options: [ 
                    { text: "付出不一定有回报，要学会看清人并保护自己。", type: "A" }, 
                    { text: "感情不能只讲逻辑，需要更多修炼沟通和共情技巧。", type: "B" }, 
                    { text: "要更坚持自我，不能轻易心软或被他人影响。", type: "C" }, 
                    { text: "如何更好地经营长期关系，而不是只追求短暂快乐。", type: "D" } 
                ] 
            } 
        ];
        
        // 人格类型定义
        const personalityTypes = { 
            A: { 
                title: "力工梭哈型", 
                description: "**核心特征：**\n你信奉'一次性巨大付出换取稳定关系'的思维模式。认为通过全盘托付（车、房、彩礼等）就能获得理想婚姻，却容易忽视自身魅力建设和情感互动。\n\n**行为模式：**\n- 习惯用物质付出替代情感投入\n- 在关系中处于被动付出地位\n- 深层次源于对传统路径的盲目跟随和自卑心理\n\n**潜在风险：**\n- 容易遭遇'二手车当新车卖'的情感陷阱\n- 婚后可能沦为ATM角色，关系地位不平衡\n- 一旦关系破裂，投入难以收回\n\n**发展建议：**\n1. 提升个人魅力和情感沟通能力\n2. 建立平等互惠的关系观念\n3. 学会在付出前评估对方真实动机" 
            }, 
            B: { 
                title: "理工脉冲型", 
                description: "**核心特征：**\n你用'解题思维'处理感情问题，将伴侣需求视为考题，通过脉冲式付出来换取认可和关系稳定。\n\n**行为模式：**\n- 把对方当作'主考官'，自己永远是'考生'\n- 习惯性反思'是不是我付出不够'\n- 容易被引导进行自我PUA\n\n**优势：**\n- 愿意为关系投入和改变\n- 具备理性分析和解决问题的能力\n- 有较强的责任心和反思精神\n\n**警示案例：**\n翟欣欣案就是典型理工思维被极端利己者利用的悲剧\n\n**成长方向：**\n1. 建立平等的伴侣关系认知\n2. 学会设立个人边界\n3. 从'解题'转向'共建'" 
            }, 
            C: { 
                title: "好大哥外耗型", 
                description: "**核心特征：**\n你奉行'让别人难受，自己享受'的外耗哲学，坚决拒绝内耗，所有问题都归因于外部因素。\n\n**行为模式：**\n- 在感情中极度自我中心\n- 擅长用各种手段拿捏伴侣\n- 享受对方屈服于自己的上位感\n\n**短期优势：**\n- 心理负担小，不易情感受伤\n- 在关系中往往占据主导地位\n- 能快速从失败关系中恢复\n\n**长期代价：**\n- 难以建立真诚持久的关系\n- 所有连接都建立在利己基础上\n- 最终可能陷入孤独状态\n\n**平衡建议：**\n在维护自我利益的同时，培养基本的责任感和共情能力" 
            }, 
            D: { 
                title: "小黄毛拿捏型", 
                description: "**核心特征：**\n你是情感战场上的'精准打击专家'，深谙特定人群心理，擅长通过三重策略实现情感拿捏。\n\n**核心策略：**\n1. **精准目标选择** - 主攻情感经历简单人群\n2. **信息茧房创造** - 让对方活在你构建的世界里\n3. **零嫌弃心态** - 只享受当下，不追究过往\n\n**拿捏技巧：**\n- 善于提供高情绪价值\n- 制造'隔离环境'削弱对方判断力\n- 用二手宝马营造'豪车'幻觉\n\n**风险提示：**\n这种建立在操控基础上的关系难以长久，建议将智慧用于建设平等真诚的亲密关系" 
            } 
        };
        
        // 初始化函数
        function init() {
            // 尝试从本地存储加载数据
            loadFromLocalStorage();
            // 显示当前题目
            showQuestion();
        }
        
        // 从本地存储加载数据
        function loadFromLocalStorage() {
            const savedData = localStorage.getItem('personalityTestData');
            if (savedData) {
                const data = JSON.parse(savedData);
                currentQuestion = data.currentQuestion || 0;
                answers = data.answers || [];
            }
        }
        
        // 保存数据到本地存储
        function saveToLocalStorage() {
            const data = {
                currentQuestion: currentQuestion,
                answers: answers
            };
            localStorage.setItem('personalityTestData', JSON.stringify(data));
        }
        
        // 显示当前题目
        function showQuestion() {
            const question = questions[currentQuestion];
            
            // 复制选项数组并随机打乱顺序
            const shuffledOptions = [...question.options].sort(() => Math.random() - 0.5);
            
            // 更新题目内容
            document.getElementById('question-number').textContent = currentQuestion + 1;
            document.getElementById('current-question').textContent = currentQuestion + 1;
            document.getElementById('question-text').textContent = question.text;
            
            // 更新选项内容（使用打乱后的顺序）
            const optionElements = document.querySelectorAll('.option');
            optionElements.forEach((optionElement, index) => {
                // 移除之前的点击事件
                const newOptionElement = optionElement.cloneNode(true);
                optionElement.parentNode.replaceChild(newOptionElement, optionElement);
                
                // 设置新的内容和属性
                const option = shuffledOptions[index];
                const optionLetter = String.fromCharCode(65 + index); // A, B, C, D
                newOptionElement.querySelector('.option-letter').textContent = optionLetter;
                newOptionElement.querySelector('.option-text').textContent = option.text;
                newOptionElement.setAttribute('data-type', option.type); // 保存真实的人格类型
                newOptionElement.setAttribute('data-display', optionLetter); // 保存显示的字母
                
                // 添加新的点击事件
                newOptionElement.onclick = function() {
                    selectOption(this);
                };
            });
            
            // 重置选项选中状态
            document.querySelectorAll('.option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // 如果有已保存的答案，显示选中状态
            if (answers[currentQuestion]) {
                const selectedOption = document.querySelector(`.option[data-type="${answers[currentQuestion]}"]`);
                if (selectedOption) {
                    selectedOption.classList.add('selected');
                }
            }
            
            // 更新进度条和按钮状态
            updateProgressBar();
            updateButtonStates();
        }
        
        // 更新进度条
        function updateProgressBar() {
            const progressPercentage = ((currentQuestion + 1) / questions.length) * 100;
            document.getElementById('progress-fill').style.width = `${progressPercentage}%`;
        }
        
        // 更新按钮状态
        function updateButtonStates() {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            
            // 上一题按钮状态
            if (currentQuestion === 0) {
                prevBtn.disabled = true;
            } else {
                prevBtn.disabled = false;
            }
            
            // 下一题按钮状态
            if (answers[currentQuestion]) {
                nextBtn.disabled = false;
            } else {
                nextBtn.disabled = true;
            }
            
            // 如果是最后一题，修改按钮文本
            if (currentQuestion === questions.length - 1) {
                nextBtn.textContent = '查看结果';
            } else {
                nextBtn.textContent = '下一题';
            }
        }
        
        // 选择选项
        function selectOption(optionElement) {
            const type = optionElement.getAttribute('data-type'); // 获取真实的人格类型
            
            // 保存答案（保存真实的人格类型，而不是显示字母）
            answers[currentQuestion] = type;
            
            // 更新选中状态
            document.querySelectorAll('.option').forEach(opt => {
                opt.classList.remove('selected');
            });
            optionElement.classList.add('selected');
            
            // 更新按钮状态和保存到本地存储
            updateButtonStates();
            saveToLocalStorage();
        }
        
        // 上一题
        function prevQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                showQuestion();
                // 保存到本地存储
                saveToLocalStorage();
            }
        }
        
        // 下一题
        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                showQuestion();
                // 保存到本地存储
                saveToLocalStorage();
            } else {
                // 所有题目答完，显示结果
                showResults();
            }
        }
        
        // 显示测试结果
        function showResults() {
            // 计算各选项的选择次数
            const counts = {
                A: 0,
                B: 0,
                C: 0,
                D: 0
            };
            
            answers.forEach(answer => {
                if (counts.hasOwnProperty(answer)) {
                    counts[answer]++;
                }
            });
            
            // 更新分数显示
            document.getElementById('score-a').textContent = counts.A;
            document.getElementById('score-b').textContent = counts.B;
            document.getElementById('score-c').textContent = counts.C;
            document.getElementById('score-d').textContent = counts.D;
            
            // 找出选择次数最多的选项
            let maxCount = 0;
            let personalityType = 'A'; // 默认类型
            
            for (const [type, count] of Object.entries(counts)) {
                if (count > maxCount) {
                    maxCount = count;
                    personalityType = type;
                }
            }
            
            // 显示人格类型和描述
            const personality = personalityTypes[personalityType];
            document.getElementById('result-title').textContent = `你是 ${personality.title}`;
            
            // 将Markdown格式的描述转换为HTML
            let htmlDescription = personality.description
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>') // 转换粗体
                .replace(/\n/g, '<br>'); // 转换换行符
            
            document.getElementById('result-description').innerHTML = htmlDescription;
            
            // 切换视图
            document.getElementById('test-view').style.display = 'none';
            document.getElementById('result-view').style.display = 'block';
            
            // 清除本地存储中的测试数据
            localStorage.removeItem('personalityTestData');
        }
        
        // 重新测试
        function restartTest() {
            // 重置变量
            currentQuestion = 0;
            answers = [];
            
            // 切换视图
            document.getElementById('result-view').style.display = 'none';
            document.getElementById('test-view').style.display = 'block';
            
            // 显示第一题
            showQuestion();
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>